<!doctype html>
<html lang="ja">
<head>
<title>
Kanji Composition Search Tool
</title>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
body { font-family: Noto Sans, Verdana, sans-serif; }
.output { letter-spacing: 3px; }
.resetspacing { letter-spacing: initial; }
.output c { display:inline-block; }
.output { max-width: 600px; }
#radical_input { max-width: 900px; font-size: 120%; line-height: 160%; letter-spacing: 3px }
.radical { cursor:pointer; }
</style>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/dompurify/1.0.10/purify.js"></script>
<script>
'use strict';
function enable_radicals()
{
    let picker = document.getElementById("radical_input");
    picker.style.display = "block";
    let button = document.getElementById("radical_toggle");
    button.onclick = disable_radicals;
}
function disable_radicals()
{
    let picker = document.getElementById("radical_input");
    picker.style.display = "none";
    let button = document.getElementById("radical_toggle");
    button.onclick = enable_radicals;
}
function fire_immediate_update()
{
    var req = new XMLHttpRequest();
    req.onreadystatechange = () =>
    { 
        if (req.readyState == 4 && req.status == 200)
        {
            if (req.responseText != "")
            {
                document.getElementById("output").innerHTML = DOMPurify.sanitize(req.responseText);
            }
        }
    }
    let formdata = new FormData(document.querySelector("form"));
    let url = "/searchlite";
    let joiner = "?";
    for (var val of formdata.entries())
    {
        url += joiner;
        joiner = "&";
        url += val[0];
        url += "=";
        url += val[1];
    }
    req.open("GET", url, true);
    req.send();
}
window.onload = () =>
{
    for(let ele of document.querySelectorAll(".radical"))
    {
        ele.onclick = (event) =>
        {
            if(event.altKey) return;
            if(event.which != 1) return;
            console.log(event);
            document.getElementById("input").value += event.target.textContent;
            fire_immediate_update();
        }
    }
    document.getElementById("input").oninput = (e) =>
    {
        if(e.isComposing) return;
        fire_immediate_update();
    };
    document.getElementById("reverse").oninput = fire_immediate_update;
    document.getElementById("simple").oninput = fire_immediate_update;
    document.getElementById("filter_level").oninput = fire_immediate_update;
}
</script>
</head>
<body>

<h1>Kanji Composition Search Tool</h1>
<form action="/search" method="get">
<input type="text" name="input" id="input" value="{{{input}}}"><button type="button" id="clear" onclick="document.getElementById('input').value = '';">clear</button>
Components and/or kanji
<br>
<input type="checkbox" name="reverse" id="reverse" {{{reverse_checked}}}>
Do decomposition (does composition if unchecked)
<br>
<input type="checkbox" name="simple" id="simple" {{{simple_checked}}}>
No recursion
<br>
<select name="filter_level" id="filter_level">
  <option value="joyoplus"     {{{selected_joyoplus}}}    >Jouyou + Jinmeiyou</option>
  <option value="media"        {{{selected_media}}}       >Found in media</option>
  <option value="kanjidicplus" {{{selected_kanjidicplus}}}>In KANJIDIC2 or media</option>
  <option value="all"          {{{selected_all}}}         >All</option>
</select>
Filtering mode
<br>
<button type="button" id=radical_toggle onclick="enable_radicals();" style="display: block;">toggle radical input</button>
<div id=radical_input style="display: none">
{{{radical_search}}}
</div>
<input type="submit" value="search">
<br>
<div class=output id=output>{{{output}}}</div>
</form>
<p>Examples:<br>
<a href="/search?input=人可&filter_level=media">人可 (compose)</a><br>
<a href="/search?input=剞&reverse=on&filter_level=media">剞 (decompose)</a><br>
<a href="/search?input=此凵&filter_level=all">此凵 (compose, rare)</a><br>
<a href="/search?input=鬱&reverse=on&simple=on&filter_level=all">鬱 (decompose, no recursion)</a><br>
<a href="/search?input=人&simple=on&filter_level=joyoplus">人 (compose, joyo plus, no recursion)</a></p>
<p>Source code: <a href="https://github.com/wareya/ids_rust/">https://github.com/wareya/ids_rust/</a></p>
</body>
</html>
